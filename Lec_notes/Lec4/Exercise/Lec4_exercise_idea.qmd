---
title: Lec4 exercise idea
---


## Idea:
+ A log wage Equation with AER::CPS1985, 
  + `demo(package = "AER")`
  + `demo("Ch-LinearRegression", package = "AER")`


## The Gender Gap of Earnings of College Graduates in the US

For this exercise problem, we'll use the `CPSSW3` dataset from the `AER` package (see `?CPSSW3` for the details). The dataset contains  trends (from 1992 to 2004) in hourly earnings in the US of working college graduates aged 25â€“34 (in 2004 USD). Here, we want to do some descriptive analysis to examine the gender gap in the earnings of college graduates.

```{r}
# === Data === #
library(AER)
data(CPSSW3)
cps_dt <- as.data.table(CPSSW3)

data(CPSSW9204)
cps_dt <- as.data.table(CPSSW9204)
```

1. Using `datasummary()` function, create a table to report the summary statistics as follows:

```{r}

datasummary(
  gender * (earnings + age) ~ Mean + SD + Min + Max + N,
  data = cps_dt,
  output = "markdown",
  title = "Example of Summary Statistics"
  )
```


2. Using `ggplot()`, create line plots showing the trend of the average wage of college graduates by gender. 



---
# hprice2: price and nox

We use the `hprice` data from the `wooldridge` package. The data is a cross-sectional data (the unit of each observation is ceunsun tract) containing the information on the housing prices in the Boston area in 1978 abd 1981. The data is sourced from the study by [Harrison and Rubinfeld (1978), JEEM](https://www-sciencedirect-com.ezp2.lib.umn.edu/science/article/pii/0095069678900062).

```{r}
# === Data === #
library(wooldridge)
data(hprice2)
# ?hprice2
hprice2 <- as.data.table(hprice2)


```

### Variable description

Main variables:

+ `price`: the median housing price
+ `nox`: Nitrous Oxide concentration; parts per million
+ `crime`: number of reported crimes per capita.
+ `rooms`: average number of rooms in houses in the community.
+ `dist`: weighted distance of the community to 5 employment centers.
+ `stratio`: average student-teacher ratio of schools in the community.


---

# Exercise Problems


## Exercise 1: Demand for Economics Journal

:::{.panel-tabset}

## Data

This exercise problem adapted from the economeric textbook of [Stock and Watson (2017)](). Here using the `Journals` data from `AER` package, we are interested in examining the demand for economics journals. The data contains the information on the subscriptions to 180 economics journals at US libraries for the year 2000. 
    
Load the data with the following code. Check the discription of the data with `?Journals`.

```{webr-r}
library(AER)
data("Journals")
# ?Journals
```


## Instructions

For anything else, exploring the data is the first step in any data analysis. "Data exploration" section contains the exercies to practice the data manipulation and visualization for descriptive data analysis. Now, it's your turn to load the package as needed. (I'm so happy if you would choose to use the packages we leaned before!)


You can skip the "Data exploration" section and move on to the "Regression analysis" section.



:::{.panel-tab}

### Data exploration
1. Find the top 10 journals with the highest citations. What about the top 10 journals with the highest price?

2. This data is taken from the year 2000. That is 

3. Calculate the summary statistics (mean, median, standard deviation) for the `price`, `pages`, `citations`, `subs`, and citations columns.

4. Using *facet_* Create a set of scatter plots that compare the relationship between `price` and various `citations`,  and `subs`, and. Show them in a grid

### Regression analysis

The goal here is to examine the demand for economics journals. Speficically, we want to estimate the price elasticity of demand for economics journals. 

1. First, create the following new variables:
  
+ `citeprice`: the price per citation . Also, if you haven't create
+ `age`: the number of years since the journal was first published (`2000 - foundingyear`).
+ `character_million`: the number of characters in the journal title divided by 1 million.

2. Estimate the following four regression models ((1)~(4)), and report the results in a table.

\being{equation}
\begin{align}
(1) \, log(subs) &= \alpah + \beta_1 log(citeprice) + e \\
(2) \, log(subs) &= \alpah + \beta_1 log(citeprice) + \beta_2 log(age) + e
(3) \, log(subs) &= \alpah + \beta_1 log(citeprice) + \beta_2 log(age) + \beta_3 log(character_million) + e \\
(4) \, log(subs) &= \alpah + \beta_1 log(citeprice) + \beta_2 log(age) + \beta_3 log(character_million)
\end{align}
\end{equation}
:::


## Solutions

```{webr-r}
library(data.table)
library(ggplot2)
library(dplyr) # For the pipe operator %>%

setDT(Journals)

# === Part 1 === #
Journals[order(citations),] # order() function sorts 

# === Part 1 === #
Journals[,.(mean_price = mean(price), median_price = median(price), sd_price = sd(price),
           mean_cites = mean(cites), median_cites = median(cites), sd_cites = sd(cites))]

# === Part 3 === #



```
:::

---

# Analysis of the Test Score Dataset (Stock and Watson (2017), Chapter 7.6)


Using the `CASchools` dataset from the `AER` package, let's do some regression analysis to examine the effects on test scores of the studnet-teacher ratio. The dataset contains data on test performance, school characteristics and student demographic backgrounds for school districts in California.

First, let's load the data. See `?CASchools` for the description of variables in the dataset.

```{r}
# === Loading Data === #
library(AER)
data("CASchools")
```


### Problems

1. Create the follwing new variables:
 + `stratio`: student-teacher ratio (`students/teachers`)
 + `score`: the average of math and reading scores (`(math + read)/2`)


2. Using `datasummary` function, generate a summary table of key descriptive statistics for the CASchools dataset, including variables like `score`, `stratio`, `english`, and `lunch`, `calworks`.

3. Using `ggplot` functions, Create scastter plots of test scores (`score`) against the percentage of English language lerners (`english`), percentage qualifying for reduced-price lunch (`lunch`), and percentage qualifying for income asistance (`calworks`). (It would be nice if you could use the `facet_wrap()` function to show them at once.)

4. Estimate the following five regression models and report the results in a table.

\begin{align}
(1) \, score &= \alpah + \beta_1 stratio + e \\
(2) \, score &= \alpah + \beta_1 stratio + \beta_2 english + e \\
(3) \, score &= \alpah + \beta_1 stratio + \beta_2 english + \beta_3 lunch + e \\
(4) \, score &= \alpah + \beta_1 stratio + \beta_2 english + \beta_3 calworks + e \\
(5) \, score &= \alpah + \beta_1 stratio + \beta_2 english + \beta_3 lunch + \beta_4 calworks + e \\
\end{align}


```{r}
# === Data === #
library(AER)
data(CASchools)
setDT(CASchools)

# === Part 1 === #
CASchools[,`:=`(
  stratio = students/teachers,
  score = (math + read)/2
  )]

# === Part 2 === #
datasummary(
  formula = score + stratio + english + lunch + calworks ~ Mean + SD + Min + Max, data = CASchools
  )

# === Part 3 === #
CASchools[,.(score, stratio, english, lunch, calworks)] %>%
  melt(id.vars = "score") %>%
  ggplot(aes(x = value, y = score)) +
  geom_point() +
  facet_wrap(~variable, scales = "free") +
  theme_bw() #this part is optional


# === Part 4 === #
rge1 <- lm(score ~ stratio, data = CASchools)
rge2 <- lm(score ~ stratio + english, data = CASchools)
reg3 <- lm(score ~ stratio + english + lunch, data = CASchools)
reg4 <- lm(score ~ stratio + english + calworks, data = CASchools)
reg5 <- lm(score ~ stratio + english + lunch + calworks, data = CASchools)

modelsummary(
  models = list(rge1, rge2, reg3, reg4, reg5),
  stars  =  c("*" = .05, "**" = .01, "***" = .001), 
  coef_map = c(
    "stratio" = "Student-teacher ratio",
    "english" = "Percent Englisch learners",
    "lunch" = "Percent eligible for subsidiezxed lunch",
    "calworks" = "Percent qualifying for CalWorks.",
    "(Intercept)" = "Intercept"
    ),
  gof_map = c("nobs", "r.squared",  "adj.r.squared"),
  fmt = 2,
  notes = list("Std. Errors in parentheses")
)
```
---

# FD, FE regression with `lm`


# 




